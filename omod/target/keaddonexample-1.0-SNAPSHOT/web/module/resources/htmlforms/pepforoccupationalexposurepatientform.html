<!--
  ~ The contents of this file are subject to the OpenMRS Public License
  ~ Version 1.0 (the "License"); you may not use this file except in
  ~ compliance with the License. You may obtain a copy of the License at
  ~ http://license.openmrs.org
  ~
  ~ Software distributed under the License is distributed on an "AS IS"
  ~ basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See the
  ~ License for the specific language governing rights and limitations
  ~ under the License.
  ~
  ~ Copyright (C) OpenMRS, LLC.  All Rights Reserved.
  -->
<htmlform>
    <script type="text/javascript" src="../moduleResources/kenyaemr/scripts/moment.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            //Defaults

            jq("#tbl-other-exposure").hide();
            jq("#tbl-specify-other-expo-device").hide();
            jq("#row-pep-previous-exposure").hide();
            jq("#tbl-pep-prev-exposure").hide();
           jq("#tbl-underlying-health-problem").hide();
           jq("#row-pep-post-assessment").hide();


            //Referred by selected
            jq("#other-exposure :input[type=radio]").change(otherExposureSelected);
             jq("#device-causing-exposure :input[type=radio]").change(otherDeviceCausingExposureSelected);
             jq("#prev-accident-expo :input[type=radio]").change(prevAccidentExpoSelected);
             jq("#pep-prev :input[type=radio]").change(pepPrevSelected);
             jq("#underlying-health-pro :input[type=radio]").change(existingHealthProSelected);
            jq("#wish-not-to-take-pep :input[type=radio]").change(wishNotToTakePepSelected);
          });

     var wishNotToTakePepSelected= function () {
            var val = jq(this).val();
            if (val == 1065 ){
                jq("#row-pep-post-assessment").show();
            }else {
                jq("#row-pep-post-assessment").hide();
                clearHiddenSections(jq("#row-pep-post-assessment"));
            }
        };

        var existingHealthProSelected = function () {
            var val = jq(this).val();
            if (val == 1065 ){
                jq("#tbl-underlying-health-problem").show();
            }else {
                jq("#tbl-underlying-health-problem").hide();
                clearHiddenSections(jq("#tbl-underlying-health-problem"));
            }
        };

         var pepPrevSelected = function () {
            var val = jq(this).val();
            if (val == 1065 ){
                jq("#tbl-pep-prev-exposure").show();
            }else {
                jq("#tbl-pep-prev-exposure").hide();
                clearHiddenSections(jq("#tbl-pep-prev-exposure"));
            }
        };

         var prevAccidentExpoSelected = function () {
            var val = jq(this).val();
            if (val == 1065 ){
                jq("#row-pep-previous-exposure").show();
            }else {
                jq("#row-pep-previous-exposure").hide();
                clearHiddenSections(jq("#row-pep-previous-exposure"));
            }
        };

        var otherDeviceCausingExposureSelected = function () {
            var val = jq(this).val();
            if (val == 5622 ){
                jq("#tbl-specify-other-expo-device").show();
            }else {
                jq("#tbl-specify-other-expo-device").hide();
                clearHiddenSections(jq("#tbl-specify-other-expo-device"));
            }
        };

            var otherExposureSelected = function () {
            var val = jq(this).val();
            if (val == 5622 ){
                jq("#tbl-other-exposure").show();
            }else {
                jq("#tbl-other-exposure").hide();
                clearHiddenSections(jq("#tbl-other-exposure"));
            }
        };



        //Before Submit
        beforeSubmit.push(function() {
            var referredBy = getValue('referral-by.value');
            var clientType = getValue('client-type.value');
            var otherReferred = jq('#other-referral input[type=text]').val();
            var infoSource = getValue('information-source.value');
            var otherInfoSource = jq('#other-information-source input[type=text]').val();
            var county = getField('county.value').val();
            if(referredBy == ""){
                getField('referral-by.error').html('Please specify referral source').show();
                return false;
            }else {
                getField('referral-by.error').html('Please specify referral source').hide();
            }


            return true;
        });

        //Clear hidden sections
        clearHiddenSections = function(parentObj) {
            parentObj.find('input[type=radio]').each(function() {
                this.checked = false;
            });
            parentObj.find('input[type=checkbox]').each(function() {
                this.checked = false;
            });
            parentObj.find('input[type=text]').each(function() {
                jq(this).val("");
            });
            parentObj.find('select').each(function() {
                this.selectedIndex =0;
            });
        }
    </script>
    <style>
        .simple-table {
        border: solid 1px #DDEEEE;
        border-collapse: collapse;
        border-spacing: 0;
        font: normal 13px Arial, sans-serif;
        }

        .simple-table thead th {
        background-color: #DDEFEF;
        border: solid 1px #DDEEEE;
        color: #336B6B;
        padding: 10px;
        text-align: left;
        text-shadow: 1px 1px 1px #fff;
        }

        .simple-table td {
        border: solid 1px #DDEEEE;
        color: #333;
        padding: 10px;
        text-shadow: 1px 1px 1px #fff;
        }
    </style>

    <div class="ke-form-header">
        <table width="100%">
            <tr>
                <td>Date of Incident: <encounterDate id="encounter-date" showTime="true" /></td>
                <td>Encounter provider: <encounterProvider default="currentUser" role="Provider"/></td>
                <td>Location: <encounterLocation default="GlobalProperty:kenyaemr.defaultLocation" type="autocomplete" /></td>
            </tr>
        </table>
    </div>

    <div class="ke-form-content">
        <fieldset class="adherence-screening">
            <legend><strong>Exposure Location Detail</strong></legend>
            <table class="simple-table" id="Checklist-tbl1">
                <tr>
                    <td><b>Cadre</b></td>
                    <td><obs required="true" conceptId="162169" rows="2" cols="50" /></td>
                    <td><b>Location during exposure</b></td>
                    <td><obs required="true" conceptId="1673" rows="2" cols="50" /></td>
                    <td><b>Date and Time of Exposure</b></td>
                    <td><obs required="true" conceptId="162601" size="50" /></td>
                </tr>
                <tr>
                    <td>Type of Exposure</td>
                    <td>
                        <obs required="true"
                             conceptId="1572"
                             answerLabels="Needle prick,Cut wound,Splash on mucosa,Splash on non intact skin,others(specify)"
                             answerConceptIds="1536,1588,1589,1601,5622"
                             style="radio"
                             id="other-violence"/><br/>
                    </td>
                    <td>
                        <table class="simple-table" id="tbl-other-violence">
                            <tr>
                                <td> Specify other exposure</td>
                                <td><obs conceptId="160716" style="textarea" rows="3"  cols="40" /></td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td>Severity of exposure</td>
                    <td>
                        <obs required="true" conceptId="159559"
                             answerLabels="Superficial,Deep"
                             answerConceptIds="1499,1500"
                             style="radio"
                             id="exposure-severity"/><br/>
                    </td>
                    <td>Device causing exposure</td>
                    <td>
                        <obs required="true"
                             conceptId="164204"
                             answerLabels="Hollow bore needle,Solid needle,Scalpel,Glass, Other (specify)"
                             answerConceptIds="460,5201,5243,136443,5622"
                             style="radio"
                             id="device-causing-exposure"/><br/>
                    </td>
                    <td>
                        <table class="simple-table" id="tbl-specify-other-expo-device">
                            <tr>
                                <td> Specify other device causing exposure</td>
                                <td><obs conceptId="160632" style="textarea" rows="3"  cols="40" /></td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td>Was the device safety designed (with sliding sheath/sleeve,guards,retractable)</td>
                    <td>
                        <obs required="true" conceptId="164875"
                             answerLabels="Yes,No"
                             answerConceptIds="1065,1066"
                             style="radio"
                             id="device-desisgned-safety"/><br/>
                    </td>
                    <td>Procedure device was used for</td>
                    <td><obs conceptId="166635" style="textarea" rows="4"  cols="40" /></td>
                </tr>
                <tr>
                    <td>Describe how the injury occurred</td>
                    <td><obs conceptId="163042" style="textarea" rows="4"  cols="40" /></td>
                </tr>
            </table>
        </fieldset>

        <!--Exposure and HIV Test History-->
        <fieldset id="Assesment-tab3">
            <legend>
                <strong>Previous Lab tests results and Exposure</strong>
            </legend>
            <table class="simple-table" id="adherence-3">
                <tr>
                    <td><b>HIV</b></td>
                    <td><obs required="true" conceptId="159427" answerLabels="Negative,Positive,Unknown" answerConceptIds="664,703,1067" style="radio" /></td>
                </tr>
                <tr>
                    <td><b>HBsAG</b></td>
                    <td><obs required="true" conceptId="161472" answerLabels="Negative,Positive,Unknown" answerConceptIds="664,703,1067" style="radio" /></td>
                </tr>
                <tr>
                    <td><b>HCV</b></td>
                    <td><obs required="true"  conceptId="161471" answerLabels="Negative,Positive,Unknown" answerConceptIds="664,703,1067" style="radio" /></td>
                </tr>
                <tr>
                    <td><b>Have you previously had an accident exposure to blood or body fluidS?</b></td>
                    <td><obs required="true" id="prev-accident-expo" conceptId="1716" answerLabels="Yes,No" answerConceptIds="1065,1066" style="radio" /></td>
                </tr>
            </table>
        </fieldset>

        <!--PEP HISTORY-->
        <fieldset id="Assesment-tab4">
            <legend>
                <strong>PEP and Immunization Detail</strong>
            </legend>
            <table class="simple-table" id="adherence-1">
                <tr id="row-pep-previous-exposure">
                    <td><b>Did you take PEP for your last exposure</b></td>
                    <td>
                        <obs required="true" id="pep-prev" conceptId="165171" answerLabels="Yes,No" answerConceptIds="1065,1066" style="radio" />
                    </td>
                    <td>
                        <table class="simple-table" id="tbl-pep-prev-exposure">
                            <tr>
                                <td><b>What regimen did you take? <strong><i>(use regimen codes)</i></strong></b></td>
                                <td>
                                    <obs required="true" id="regimen-taken" conceptId="166086" rows="2" cols="40" />
                                </td>
                            </tr>
                            <tr>
                                <td><b>For how many days?</b></td>
                                <td>
                                    <obs required="true" id="pep-prev-duration" conceptId="165170" rows="2" cols="40"/> <span><strong>days</strong></span>
                                </td>
                            </tr>
                            <tr id="row-pep-prev-completed">
                                <td><b>If less than 28 days, give reason why the dose was not completed?</b></td>
                                <td>
                                    <obs id="pep-prev-not-completed" conceptId="160632" rows="3" cols="40" style="textarea"/>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                  <td><b>Have you had Hepatitis B immunization</b></td>
                  <td><obs required="true" id="hep-b-vaccine" conceptId="159430" answerLabels="Yes fully (3 doses),Yes partially (1-2 doses),No" answerConceptIds="1065,1067,1066" style="radio" /></td>
                </tr>
                <tr>
                    <p align="left"><strong>STARTER PACK FOR PEP</strong></p>
                    <hr/>
                    <td><b>I do wish to take PEP</b></td>
                    <td><obs required="true" id="wish-not-to-take-pep" conceptId="164845" answerLabels="Yes,No" answerConceptIds="1065,1066" style="radio" /></td>
                </tr>
            </table>
        </fieldset>

        <!-- Baseline -->
        <fieldset id="Assesment-tab7">
            <legend>
                <strong>Clinical History</strong>
            </legend>
            <table class="simple-table" id="adherence-7">
                <includeIf velocityTest="$patient.gender == 'F' ">
                <tr>
                    <td><b>Is the health care worker pregnant?</b></td>
                    <td><obs  conceptId="1523" answerLabels="Yes,No" answerConceptIds="1065,1065" style="radio" /></td>
                </tr>
                <tr>
                    <td><b>Is the health care worker Breastfeeding?</b></td>
                    <td><obs  conceptId="5632" answerLabels="Yes,No" answerConceptIds="1065,1065" style="radio" /></td>
                </tr>
                </includeIf>
                <tr>
                    <td><b>Does the health care worker have any underlying health problems?</b></td>
                    <td><obs id="underlying-health-pro"  conceptId="164878" answerLabels="Yes,No" answerConceptIds="1065,1065" style="radio" /></td>
                    <td>
                        <table class="simple-table" id="tbl-underlying-health-problem">
                            <tr>
                                <td><b>What are the underlying health problem?</b></td>
                                <td>
                                    <obs required="true" id="underlying-pro" conceptId="163042" rows="3" cols="40" style="textarea" />
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td><b>Is the health care worker on any medication?</b></td>
                    <td><obs  conceptId="161472" answerLabels="Yes,No" answerConceptIds="1065,1065" style="radio" /></td>
                </tr>
                <tr>
                    <td colspan="2"><b><p>NB: Request Baseline Investigations for Exposed Health Care Worker via Lab Request modules</p></b></td>
                </tr>
                <tr>
                    <td><b>Preliminary Classification?</b></td>
                    <td><obs required="true" conceptId="165053" answerLabels="Low,Risk" answerConceptIds="1065,1066" style="radio" /></td>
                </tr>
                <tr id="row-pep-post-assessment">
                    <td><b>ARV regimen provided after assessment?</b></td>
                    <td><obs required="true" conceptId="163104" rows="3" cols="60" /></td>
                    <td><b>Date provided regimen</b></td>
                    <td><obs required="true" conceptId="166865" size="50" /></td>
                </tr>
                <tr>
                    <td><b>TCA Date</b></td>
                    <td><obs conceptId="160753" required="true" size="50" allowFutureDates="true" /></td>
                </tr>

            </table>
        </fieldset>
    </div>
    <div class="ke-form-footer">
        <submit />
    </div>

</htmlform>